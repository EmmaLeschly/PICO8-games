pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
rectfill(0,64,128,128,6)

// for each x position
for i=0,127 do
 
 // find starting tile
 x=px
 y=py
 
 // find ray direction
 vx=cos(pa-(i-64)/512)
 vy=sin(pa-(i-64)/512)
 
 // find standard distance
 dx=abs(1/vx)
 dy=abs(1/vy)
 
 // find increment value
 ix=vx>0 and 1 or -1
 iy=vy>0 and 1 or -1
 
 // find initial offset
 if vx>0 then
  ox=(flr(x)-x+1)/vx
 else
  ox=abs((x-flr(y))/vy)
 end
 if vy>0 then
  oy=(flr(y)-y+1)/vy
 else
  oy=abs((y-flr(y)/vy))
 end
 
 while true do
  // horizontal intersection
  if ox<oy then
   x+=ix
   d=ox
   ox+=dx
  else // vertical intersection
   y+=iy
   d=oy
   oy+=dy
  end
  // check for collision
  if mget(x,y)>0 or x<0 or x>15 or y<0 or y>15 then
   line(i,64-h/d,i,64+h/d,cs[mget(x,y)])
   break
  end
 end
end
__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
